<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome to Camp Acey | Bachelorette Weekend</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --pine: #1f3b32;
      --pine-light: #2d5243;
      --cream: #faf5f0;
      --snow: #f3f7fb;
      --accent: #c35b4c;
      --gold: #d9a441;
      --text: #1f2528;
      --muted: #6b7a86;
      --card-radius: 18px;
      --shadow-soft: 0 16px 30px rgba(0,0,0,0.12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Nunito", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(to bottom, #0f2027, #203a43, #2c5364);
      color: var(--text);
      min-height: 100vh;
    }

    .page-wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 18px 60px;
    }

    .glass-card {
      position: relative;
      background: rgba(250, 245, 240, 0.96);
      border-radius: 26px;
      box-shadow: var(--shadow-soft);
      padding: 24px 20px 32px;
      border: 30px solid transparent;
      border-image: url('plaid.jpg') 30 round;
      border-top-width: 30px;
      border-bottom-width: 30px;
      backdrop-filter: blur(12px);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 20px;
    }

    .camp-badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 8px 14px;
      border-radius: 999px;
      background: linear-gradient(120deg, #214438, #2d5b4a);
      color: #fdfbf7;
      font-size: 0.8rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .camp-badge span.emoji {
      font-size: 1.1rem;
    }

    .hero-title {
      font-family: "Playfair Display", Georgia, "Times New Roman", serif;
      font-size: clamp(2.3rem, 3.1vw, 3rem);
      color: var(--pine);
      line-height: 1.05;
      letter-spacing: 0.02em;
    }

    .hero-sub {
      font-size: 0.96rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .hero-meta {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--pine-light);
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .hero-meta a.hero-location-link {
      color: var(--pine-light);
      text-decoration: underline;
      text-decoration-thickness: 1px;
    }

    .hero-meta a.hero-location-link:hover {
      text-decoration-thickness: 2px;
    }

    /* Collapsible inner boxes (totals/balances/paybacks) */
    .collapsible {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.25s ease, opacity 0.25s ease;
    }

    .collapsible.open {
      max-height: 800px;
      opacity: 1;
    }

    /* Cabin-core toggle buttons */
    .summary-toggle,
    .settlements-toggle {
      border: 1px solid rgba(31,59,50,0.18);
      border-radius: 999px;
      background: #ffffff;
      color: var(--pine-light);
      font-size: 0.78rem;
      padding: 4px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      text-decoration: none;
      transition:
        background 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.1s ease,
        border-color 0.15s ease;
    }

    .summary-toggle:hover,
    .settlements-toggle:hover {
      background: linear-gradient(135deg, #fdfbf7, #f3f7fb);
      border-color: rgba(31,59,50,0.35);
      box-shadow: 0 4px 8px rgba(0,0,0,0.08);
      transform: translateY(-1px);
    }

    .summary-toggle:active,
    .settlements-toggle:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .toggle-icon {
      font-size: 0.7rem;
      transition: transform 0.2s ease;
    }

    /* Honoring row */
    .honor-row {
      margin-top: 14px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: nowrap;
    }

    .honor-badge {
      padding: 14px 24px;
      border-radius: 999px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.08);
      box-shadow: 0 10px 20px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-width: 150px;
    }

    .honor-label {
      font-size: 0.78rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
    }

    .honor-name {
      margin-top: 2px;
      font-size: 1rem;
      font-weight: 700;
      color: var(--pine);
    }

    .honor-photos {
      display: flex;
      gap: 10px;
      flex-wrap: nowrap;
    }

    .honor-photo {
      width: 82px;
      height: 82px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    @media (max-width: 700px) {
      .honor-row {
        flex-wrap: wrap;
        align-items: flex-start;
      }

      .honor-photos {
        flex-wrap: wrap;
      }

      .honor-photo {
        width: 72px;
        height: 72px;
      }
    }

    /* Countdown */
    .countdown-section {
      margin: 10px 0 8px;
    }

    .countdown-banner {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 18px;
      padding: 12px 18px;
      border-radius: 18px;
      background: rgba(250, 245, 240, 0.9);
      border: 1px solid rgba(31,59,50,0.12);
      box-shadow: 0 10px 20px rgba(0,0,0,0.06);
    }

    .countdown-banner-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .countdown-label {
      font-size: 0.78rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--pine-light);
      font-weight: 700;
    }

    .countdown-note {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .countdown-values {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .count-box {
      min-width: 70px;
      padding: 6px 10px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.08);
      text-align: center;
    }

    .count-box span {
      display: block;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--pine);
      font-variant-numeric: tabular-nums;
      line-height: 1.1;
    }

    .count-box small {
      display: block;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-top: 2px;
    }

    @media (max-width: 680px) {
      .countdown-banner {
        flex-direction: column;
        align-items: flex-start;
      }

      .countdown-values {
        width: 100%;
        justify-content: space-between;
      }
    }

    .hero-meta span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.04);
    }

    .hero-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    .btn {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 0.92rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #e27b66);
      color: #fff7f3;
      box-shadow: 0 10px 20px rgba(195, 91, 76, 0.35);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.95);
      border: 1px solid rgba(31,59,50,0.12);
      color: var(--pine);
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(0,0,0,0.12);
    }

    .btn span.icon {
      font-size: 1rem;
    }

    /* Hero art omitted for brevity ‚Äì leaving as-is from your original */
    .hero-illustration { display:none; } /* if you re-add it, keep existing styles */

    .tagline {
      font-size: 0.8rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: #4c6477;
      margin-bottom: 4px;
    }

    .card-footer-text {
      font-size: 0.8rem;
      color: #4c6477;
    }

    /* ---------- MAIN LAYOUT + ACCORDIONS ---------- */

    main {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    details.main-accordion {
      border-radius: var(--card-radius);
      background: var(--snow);
      border: 1px solid rgba(31,59,50,0.10);
      box-shadow: 0 10px 18px rgba(0,0,0,0.04);
      overflow: hidden;
    }

    summary.accordion-summary {
      list-style: none;
      cursor: pointer;
      padding: 10px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      background: linear-gradient(135deg, #214438, #2d5b4a);
      color: #fdfbf7;
      font-family: inherit;
    }

    summary.accordion-summary::-webkit-details-marker {
      display: none;
    }

    .accordion-summary-left {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 2px;
    }

    .accordion-summary-title {
      font-size: 0.92rem;
      font-weight: 700;
      letter-spacing: 0.14em;
      text-transform: uppercase;
    }

    .accordion-summary-sub {
      font-size: 0.8rem;
      opacity: 0.9;
    }

    .accordion-summary-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(250,245,240,0.12);
      border: 1px solid rgba(244,232,219,0.45);
      font-size: 0.76rem;
    }

    .accordion-summary-pill .chevron {
      transition: transform 0.2s ease;
    }

    details.main-accordion > .accordion-body {
      padding: 14px 16px 16px;
    }

    details.main-accordion[open] .accordion-summary-pill .chevron {
      transform: rotate(180deg);
    }

    section {
      background: transparent;
      border-radius: var(--card-radius);
      padding: 0;
      border: none;
    }

    /* Budget card styles */
    #signup {
      margin-bottom: 22px;
    }

    #budget {
      margin-top: 0;
      background: #f7fbf4;
      border-radius: var(--card-radius);
      border: 1px solid rgba(31,59,50,0.10);
      box-shadow: 0 10px 22px rgba(0,0,0,0.05);
      padding: 18px 16px 20px;
    }

    #budget .section-header {
      padding-bottom: 6px;
      margin-bottom: 10px;
      border-bottom: 1px solid rgba(31,59,50,0.08);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
      gap: 10px;
    }

    .section-title {
      font-size: 1rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--pine);
    }

    .section-sub {
      font-size: 0.82rem;
      color: var(--muted);
    }

    .day-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
    }

    .day-card {
      padding: 10px 12px;
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.06);
    }

    .day-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }

    .day-name {
      font-weight: 700;
      font-size: 0.9rem;
      color: var(--pine-light);
    }

    .day-meta {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .timeline {
      margin-top: 4px;
      padding-left: 0;
      list-style: none;
    }

    .timeline li {
      display: grid;
      grid-template-columns: 65px minmax(0, 1fr);
      gap: 8px;
      font-size: 0.86rem;
      padding: 3px 0;
    }

    .timeline-time {
      font-weight: 600;
      color: var(--pine);
    }

    .timeline-text span {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: rgba(217,164,65,0.12);
      color: var(--gold);
      margin-top: 2px;
    }

    .note {
      margin-top: 8px;
      font-size: 0.78rem;
      color: var(--muted);
      font-style: italic;
    }

    .budget-helper-text {
      font-size: 0.84rem;
      color: var(--muted);
      margin-top: 4px;
      margin-bottom: 10px;
    }

    .budget-participants {
      margin-top: 10px;
      margin-bottom: 8px;
    }

    #camperNames {
      min-height: 70px;
      font-size: 0.88rem;
    }

    .field-hint {
      font-size: 0.76rem;
      color: var(--muted);
    }

    .expense-form {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.7fr) minmax(0, 0.9fr) minmax(0, 0.9fr);
      gap: 10px;
      align-items: flex-end;
    }

    .expense-form .btn {
      justify-self: flex-start;
      margin-top: 4px;
    }

    @media (max-width: 900px) {
      .expense-form {
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      }
    }

    @media (max-width: 600px) {
      .expense-form {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .participants-group {
      margin-top: 12px;
    }

    .participants-list {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px 12px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.08);
      font-size: 0.84rem;
    }

    .participants-list label.participants-label {
      position: relative;
      display: inline-flex;
      cursor: pointer;
    }

    .participants-list label.participants-label input[type="checkbox"] {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .participants-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 11px;
      border-radius: 999px;
      background: #f3f7fb;
      border: 1px solid rgba(31,59,50,0.18);
      color: var(--pine-light);
      font-size: 0.8rem;
      transition: background 0.15s ease, border 0.15s ease,
                  box-shadow 0.15s ease, color 0.15s ease, transform 0.1s ease;
    }

    .participants-toggle .toggle-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: rgba(117, 69, 49, 0.4);
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.7);
    }

    .participants-toggle .toggle-name {
      white-space: nowrap;
    }

    .participants-list label.participants-label input[type="checkbox"]:checked + .participants-toggle {
      background: linear-gradient(135deg, #214438, #2d5b4a);
      border-color: rgba(17,40,33,0.9);
      color: #fdfbf7;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      transform: translateY(-1px);
    }

    .participants-list label.participants-label input[type="checkbox"]:checked + .participants-toggle .toggle-dot {
      background: #f8d99b;
      box-shadow: 0 0 4px rgba(248,217,155,0.9);
    }

    .expense-layout {
      margin-top: 16px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 0.9fr);
      gap: 14px;
    }

    @media (max-width: 900px) {
      .expense-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .mini-heading {
      font-size: 0.82rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--pine);
      margin-bottom: 6px;
    }

    .settle-line {
      display: flex;
      align-items: baseline;
      gap: 6px;
      padding: 3px 0;
    }

    .settle-name {
      font-weight: 600;
      color: var(--pine);
    }

    .settle-action {
      font-size: 0.82rem;
      color: var(--muted);
    }

    .settle-amount {
      font-variant-numeric: tabular-nums;
    }

    #expenseTable {
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.06);
      padding: 8px 10px;
      font-size: 0.86rem;
      max-height: 240px;
      overflow-y: auto;
    }

    .expense-table-empty {
      font-size: 0.82rem;
      color: var(--muted);
    }

    .expense-row {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.7fr) minmax(0, 0.9fr);
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(31,59,50,0.06);
    }

    .expense-row:last-child {
      border-bottom: none;
    }

    .expense-row-main {
      font-weight: 600;
      color: var(--pine);
    }

    .expense-row-note {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .expense-amount {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .expense-meta {
      text-align: right;
      font-size: 0.78rem;
      color: var(--muted);
    }

    .expense-summary-body {
      border-radius: 12px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.06);
      padding: 8px 10px;
      font-size: 0.86rem;
    }

    .balance-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    .balance-name {
      font-weight: 600;
      color: var(--pine);
    }

    .balance-amount {
      font-variant-numeric: tabular-nums;
    }

    .balance-positive {
      color: var(--pine);
    }

    .balance-negative {
      color: var(--accent);
    }

    form {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 0.78rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--pine-light);
    }

    input, select, textarea {
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid rgba(31,59,50,0.16);
      font-family: inherit;
      font-size: 0.9rem;
      outline: none;
      background: #ffffff;
      transition: border 0.15s ease, box-shadow 0.15s ease;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(195,91,76,0.36);
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .form-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 4px;
      font-size: 0.78rem;
      color: var(--muted);
      flex-wrap: wrap;
    }

    .contrib-intro {
      font-size: 0.84rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .contrib-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .contrib-item {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: 10px;
      align-items: center;
      background: #ffffff;
      border-radius: 10px;
      padding: 6px 8px;
      border: 1px solid rgba(31,59,50,0.06);
      font-size: 0.84rem;
    }

    .contrib-item span.label-text {
      font-weight: 600;
      color: var(--pine);
    }

    .contrib-item small {
      display: block;
      font-size: 0.74rem;
      color: var(--muted);
      margin-top: 2px;
    }

        /* ---------- FULL CONTRIBUTION LIST (display only) ---------- */

        /* ---------- FULL CONTRIBUTION LIST (display only) ---------- */

    .contrib-table {
      margin-top: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .contrib-group {
      border-radius: 16px;
      background: #ffffff;
      border: 1px solid rgba(31,59,50,0.10);
      box-shadow: 0 8px 16px rgba(0,0,0,0.04);
      overflow: hidden;
    }

    .full-contrib-header {
      width: 100%;
      border: none;
      background: #f3f7fb;
      padding: 9px 14px;
      display: grid;
      grid-template-columns: minmax(0, 1fr) auto auto;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      font-size: 0.9rem;
      color: var(--pine);
    }

    .full-contrib-header .cat-label {
      font-weight: 700;
    }

    .full-contrib-header .pill {
      justify-self: center;
      min-width: 34px;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.76rem;
      font-weight: 600;
      background: #e4ebf3;
      text-align: center;
    }

    .full-contrib-header .chevron {
      font-size: 0.8rem;
      color: var(--muted);
      transition: transform 0.15s ease;
      justify-self: end;
    }

    .contrib-group.open .full-contrib-header .chevron {
      transform: rotate(180deg);
    }

    .contrib-body {
      display: none;
      padding: 8px 14px 10px;
      border-top: 1px solid rgba(31,59,50,0.06);
      background: #ffffff;
    }

    .contrib-group.open .contrib-body {
      display: block;
    }

    .contrib-body-head,
    .contrib-row {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.5fr) auto;
      gap: 12px;
      align-items: center;
      font-size: 0.86rem;
    }

    .contrib-body-head {
      padding-bottom: 4px;
      margin-bottom: 4px;
      border-bottom: 1px solid rgba(31,59,50,0.10);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .contrib-row {
      padding: 4px 0;
      border-bottom: 1px solid rgba(31,59,50,0.04);
    }

    .contrib-row:last-child {
      border-bottom: none;
    }

    .contrib-row-name {
      font-weight: 600;
      color: var(--pine);
      word-break: break-word;
    }

    .contrib-row-item {
      color: var(--pine-light);
      word-break: break-word;
    }

    .contrib-row-actions {
      text-align: right;
    }

    .contrib-remove {
      border-radius: 999px;
      border: 1px solid rgba(195,91,76,0.5);
      background: #fff7f3;
      color: var(--accent);
      font-size: 0.76rem;
      padding: 4px 10px;
      cursor: pointer;
      white-space: nowrap;
      transition:
        background 0.15s ease,
        border-color 0.15s ease,
        box-shadow 0.1s ease,
        transform 0.1s ease;
    }

    .contrib-remove:hover {
      background: #ffe0d7;
      border-color: var(--accent);
      box-shadow: 0 2px 5px rgba(0,0,0,0.08);
      transform: translateY(-1px);
    }


    .countdown-plaid-bg {
      width: 100%;
      padding: 16px 0;
      background-image: url('plaid.jpg');
      background-size: 600px;
      opacity: 1.0;
      background-repeat: repeat;
      background-position: center;
      border-radius: 16px;
      margin: 0 auto 24px;
      display: flex;
      justify-content: center;
    }

    footer {
      margin-top: 18px;
      font-size: 0.76rem;
      color: rgba(255,255,255,0.75);
      text-align: center;
    }

    @media (max-width: 860px) {
      header {
        flex-direction: column;
        align-items: flex-start;
      }

      main {
        gap: 16px;
      }
    }

    @media (max-width: 600px) {
      .page-wrap {
        padding: 16px 10px 40px;
      }

      .glass-card {
        border-width: 16px;
        padding: 16px 10px 24px;
        border-radius: 20px;
      }

      .hero-title {
        font-size: 1.9rem;
        line-height: 1.15;
      }

      .hero-sub {
        font-size: 0.9rem;
      }

      .hero-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }

      .honor-row {
        flex-wrap: wrap;
        gap: 10px;
      }

      .honor-badge {
        padding: 10px 18px;
        min-width: auto;
      }

      .honor-photo {
        width: 68px;
        height: 68px;
      }

      .countdown-section {
        margin: 8px 0 10px;
      }

      .countdown-plaid-bg {
        padding: 10px 6px;
        border-radius: 12px;
      }

      .countdown-banner {
        padding: 10px 12px;
        gap: 12px;
      }

      .count-box {
        min-width: 58px;
        padding: 4px 6px;
      }

      .count-box span {
        font-size: 1rem;
      }

      main {
        margin-top: 12px;
      }

      .day-card {
        padding: 8px 10px;
      }

      .timeline li {
        grid-template-columns: 60px minmax(0, 1fr);
        font-size: 0.82rem;
      }

      .contrib-item {
        grid-template-columns: minmax(0, 1fr);
      }

      .expense-layout {
        grid-template-columns: minmax(0, 1fr);
      }

      .expense-row {
        grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.8fr);
      }

      .expense-meta {
        text-align: left;
      }

      .hero-cta {
        flex-direction: column;
        align-items: stretch;
      }

      .hero-cta .btn {
        justify-content: center;
        width: 100%;
      }

      #signup .form-footer {
        flex-direction: column;
        align-items: flex-start;
      }

      #signup .form-footer .btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media (max-width: 400px) {
      .hero-title {
        font-size: 1.7rem;
      }
      .glass-card {
        border-width: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <div class="glass-card">
      <header>
        <div style="width:100%; margin-bottom:20px; text-align:center;">
          <img src="Floral Wreath.png" style="width:100%; max-width:900px; border-radius:20px; box-shadow:0 8px 20px rgba(0,0,0,0.15);" />
        </div>

        <div>
          <h1 class="hero-title">Jenny's Bachelorette Weekend</h1>
          <p class="hero-sub">
            A cozy winter escape in Lake Placid with cabins, cocoa, and just the right amount of chaos.
          </p>

          <div class="hero-meta">
            <span>
              <strong>Cabin Location:</strong>
              <a
                href="https://www.google.com/maps/search/?api=1&query=231+John+Brown+Rd.+Lake+Placid+NY+12946"
                target="_blank"
                rel="noopener"
                class="hero-location-link"
              >
                Lake Placid, NY
              </a>
            </span>
            <span><strong>Dates:</strong> <em>January 30 ‚Äì February 1, 2026</em></span>
          </div>

          <div class="honor-row">
            <div class="honor-badge">
              <div class="honor-label">Honoring</div>
              <div class="honor-name">Jenny</div>
            </div>

            <div class="honor-photos">
              <img src="jrubs4.png" alt="Jenny photo 1" class="honor-photo" />
              <img src="jrubs2.png" alt="Jenny photo 2" class="honor-photo" />
              <img src="jrubs5.png" alt="Jenny photo 3" class="honor-photo" />
            </div>
          </div>

           </div>
      </header>

      <!-- Countdown banner -->
      <section class="countdown-section">
        <div class="countdown-plaid-bg">
          <div class="countdown-banner" id="camp-countdown">
            <div class="countdown-banner-left">
              <div class="countdown-label">Countdown to Camp Acey</div>
              <div class="countdown-note" id="cd-note"></div>
            </div>
            <div class="countdown-values">
              <div class="count-box">
                <span id="cd-days">--</span>
                <small>Days</small>
              </div>
              <div class="count-box">
                <span id="cd-hours">--</span>
                <small>Hours</small>
              </div>
              <div class="count-box">
                <span id="cd-mins">--</span>
                <small>Minutes</small>
              </div>
              <div class="count-box">
                <span id="cd-secs">--</span>
                <small>Seconds</small>
              </div>
            </div>
          </div>
        </div>
      </section>

      <main>
        <!-- WEEKEND ITINERARY -->
        <details class="main-accordion">
          <summary class="accordion-summary">
            <div class="accordion-summary-left">
              <div class="accordion-summary-title">Weekend Itinerary</div>
              <div class="accordion-summary-sub">
                Subject to change if we get snowed in (manifesting ‚ùÑÔ∏è)
              </div>
            </div>
            <div class="accordion-summary-pill">
              <span>Show / Hide</span>
              <span class="chevron">‚ñæ</span>
            </div>
          </summary>

          <div class="accordion-body">
            <section id="itinerary">
              <div class="day-list">
                <div class="day-card">
                  <div class="day-header">
                    <div class="day-name">Friday ‚Ä¢ Arrival &amp; Campfire Night</div>
                    <div class="day-meta">Travel + Settling In</div>
                  </div>
                  <ul class="timeline">
                    <li>
                      <div class="timeline-time">4:00 PM</div>
                      <div class="timeline-text">Cabin check-in &amp; spiked hot cocoa bar</div>
                    </li>
                    <li>
                      <div class="timeline-time">6:30 PM</div>
                      <div class="timeline-text">Welcome dinner (pizza and wings) &amp; Camp Acey introductions <span>Dress: Cozy sweaters, Flannel &amp; faux fur</span></div>
                    </li>
                    <li>
                      <div class="timeline-time">8:30 PM</div>
                      <div class="timeline-text">Fireside games, toasts &amp; s‚Äômores</div>
                    </li>
                    <li>
                      <div class="timeline-time">10:30 PM</div>
                      <div class="timeline-text">Pajama party</div>
                    </li>
                  </ul>
                </div>

                <div class="day-card">
                  <div class="day-header">
                    <div class="day-name">Saturday ‚Ä¢ Full Camp Acey</div>
                    <div class="day-meta">Theme Day: Winter Cabin-Core</div>
                  </div>
                  <ul class="timeline">
                    <li>
                      <div class="timeline-time">8:00 AM</div>
                      <div class="timeline-text">Breakfast, mimosas (and mountains), coffee/tea bar</div>
                    </li>
                    <li>
                      <div class="timeline-time">9:15 AM</div>
                      <div class="timeline-text">Mirror Lake Inn Spa: Jenny &amp; Abby</div>
                    </li>
                    <li>
                      <div class="timeline-time">10:00 AM</div>
                      <div class="timeline-text">Mirror Lake Inn Spa: Steph &amp; Andrea</div>
                    </li>
                    <li>
                      <div class="timeline-time">10:30 AM</div>
                      <div class="timeline-text">Mirror Lake Inn Spa: Chelsea &amp; Nicole</div>
                    </li>
                    <li>
                      <div class="timeline-time">12:30 AM</div>
                      <div class="timeline-text">Lunch</div>
                    </li>
                    <li>
                      <div class="timeline-time">2:00 PM</div>
                      <div class="timeline-text">Dog sled rides: Thunder Mountain ($20pp)</div>
                    </li>
                    <li>
                      <div class="timeline-time">5:30 PM</div>
                      <div class="timeline-text">Get ready: Glam camp photos &amp; cocktails <span>Dress: Flannel &amp; faux fur</span></div>
                    </li>
                    <li>
                      <div class="timeline-time">7:00 PM</div>
                      <div class="timeline-text">Bachelorette dinner &amp; nighttime festivities - Let‚Äôs get toasted!</div>
                    </li>
                  </ul>
                </div>

                <div class="day-card">
                  <div class="day-header">
                    <div class="day-name">Sunday ‚Ä¢ Cozy Goodbyes</div>
                    <div class="day-meta">Travel Day</div>
                  </div>
                  <ul class="timeline">
                    <li>
                      <div class="timeline-time">10:30 AM</div>
                      <div class="timeline-text">Cabin checkout</div>
                    </li>
                    <li>
                      <div class="timeline-time">11:00 AM</div>
                      <div class="timeline-text">Brunch at Big Slide Brewery</div>
                    </li>
                  </ul>
                </div>
              </div>
              <p class="note">
                ‚úâÔ∏è Final details (packing list, room assignments, carpool info) will be sent closer to the weekend.
              </p>
            </section>
          </div>
        </details>

        <!-- CAMP ACEY CONTRIBUTIONS -->
        <details class="main-accordion">
          <summary class="accordion-summary">
            <div class="accordion-summary-left">
              <div class="accordion-summary-title">Camp Acey Contributions</div>
              <div class="accordion-summary-sub">
                Claim what you‚Äôre bringing so we have the perfect mix of snacks, drinks &amp; cozy cabin goodies.
              </div>
            </div>
            <div class="accordion-summary-pill">
              <span>Show / Hide</span>
              <span class="chevron">‚ñæ</span>
            </div>
          </summary>

          <div class="accordion-body">
            <section id="signup">
              <p class="contrib-intro">
                Please add your name next to 1‚Äì3 items you‚Äôre willing to bring. Everyone will be able to see this list update,
                so we all know who‚Äôs bringing what up front.
              </p>

              <form id="camp-form" action="#" method="post" onsubmit="handleFormSubmit(event)">
                <div class="field-group">
                  <label for="name">Your Name</label>
                  <select id="name" name="name" required>
                    <option value="">Select your name</option>
                    <!-- Options filled by JS -->
                  </select>
                </div>

                <div class="field-group">
                  <label>Claim your items</label>
                  <div class="contrib-list">
                    <div class="contrib-item" data-category="Snacks & chips">
                      <div>
                        <span class="label-text">Snacks &amp; chips</span>
                        <small>Think salty, crunchy, munchy.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="snacks" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Desserts / sweet treats">
                      <div>
                        <span class="label-text">Desserts / sweet treats</span>
                        <small>Cookies, brownies, cupcakes, etc.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="desserts" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Charcuterie / cheese board">
                      <div>
                        <span class="label-text">Charcuterie / cheese board</span>
                        <small>Cheese, meats, crackers, jams, etc.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="charcuterie" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Breakfast & brunch items">
                      <div>
                        <span class="label-text">Breakfast &amp; brunch items</span>
                        <small>Bagels, pastries, egg bake, fruit, etc.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="breakfast" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Beer/Wine/Liquor">
                      <div>
                        <span class="label-text">Beer/Wine/Liquor</span>
                        <small>Beer, wine, spirits, special bottles.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="alcohol" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="NA Beverages / mixers">
                      <div>
                        <span class="label-text">NA Beverages / mixers</span>
                        <small>Seltzers, juices, mocktails, mixers.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="na" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Coffee & tea station">
                      <div>
                        <span class="label-text">Coffee &amp; tea station</span>
                        <small>Coffee, filters, creamers, syrups, tea.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="coffee" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Game/Activity">
                      <div>
                        <span class="label-text">Game/Activity</span>
                        <small>Board games, card games, bachelorette games.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="game" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Decor & ambiance">
                      <div>
                        <span class="label-text">Decor &amp; ambiance</span>
                        <small>Banners, candles, fairy lights, bride swag.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="decor" placeholder="What you‚Äôll bring" />
                    </div>

                    <div class="contrib-item" data-category="Other Item">
                      <div>
                        <span class="label-text">Other Item</span>
                        <small>Anything fun or helpful that doesn‚Äôt fit above.</small>
                        <div class="contrib-names"></div>
                      </div>
                      <input type="text" name="otherItem" placeholder="What you‚Äôll bring" />
                    </div>
                  </div>
                </div>

                <div class="form-footer">
                  <button type="submit" class="btn btn-primary">
                    <span class="icon">üì¨</span>
                    Submit my contributions
                  </button>
                  <div>
                    This list updates live so everyone can see who‚Äôs bringing what.
                  </div>
                </div>
              </form>
            </section>
          </div>
        </details>

        <!-- FULL CONTRIBUTION LIST -->
        <details class="main-accordion">
          <summary class="accordion-summary">
            <div class="accordion-summary-left">
              <div class="accordion-summary-title">Full Contribution List</div>
              <div class="accordion-summary-sub">
                See everything the Camp Acey crew has signed up to bring.
              </div>
            </div>
            <div class="accordion-summary-pill">
              <span>Show / Hide</span>
              <span class="chevron">‚ñæ</span>
            </div>
          </summary>

          <div class="accordion-body">
            <section id="all-contributions">
              <div id="all-contrib-table" class="contrib-table">
                Loading contributions‚Ä¶
              </div>
            </section>
          </div>
        </details>

        <!-- SHARED EXPENSES -->
        <details class="main-accordion">
          <summary class="accordion-summary">
            <div class="accordion-summary-left">
              <div class="accordion-summary-title">Shared Expenses</div>
              <div class="accordion-summary-sub">
                Add Ubers, meals, drinks &amp; more. We‚Äôll split each expense between the right campers.
              </div>
            </div>
            <div class="accordion-summary-pill">
              <span>Show / Hide</span>
              <span class="chevron">‚ñæ</span>
            </div>
          </summary>

          <div class="accordion-body">
            <section id="budget">
              <div class="section-header">
                <h2 class="section-title">Shared Expenses</h2>
                <p class="section-sub">
                  Add Ubers, meals, drinks &amp; more. We‚Äôll split each expense between only the girls who participated so the right camper is reimbursed.
                </p>
              </div>

              <p class="budget-helper-text">
                Start by listing everyone on the trip, then add each expense as it happens. Balances update automatically.
              </p>

              <!-- Participants selection -->
              <div class="budget-participants">
                <div class="field-group participants-group">
                  <label>Who participated in this expense?</label>

                  <div id="expenseParticipantsWrapper">
                    <div id="expenseParticipants" class="participants-list">
                      <small class="field-hint">
                        Toggle the campers below to include them in this expense.
                        If no one is selected, we‚Äôll split it between everyone.
                      </small>
                    </div>
                  </div>

                  <div id="toggleAllParticipants"
                       style="margin-top:6px; font-size:0.8rem; color:var(--pine-light); cursor:pointer; text-decoration:underline;">
                    Select all
                  </div>
                </div>
              </div>

              <!-- Add expense form -->
              <div class="expense-form">
                <div class="field-group">
                  <label for="expenseDesc">Expense</label>
                  <input id="expenseDesc" type="text"
                         placeholder="Dinner at Smoke Signals, Uber to cabin, drinks, etc." />
                </div>

                <div class="field-group">
                  <label for="expenseAmount">Amount</label>
                  <input id="expenseAmount" type="number" min="0" step="0.01" placeholder="0.00" />
                </div>

                <div class="field-group">
                  <label for="expenseCategory">Category</label>
                  <select id="expenseCategory">
                    <option value="">Select category</option>
                    <option value="Uber / Lyft">Uber / Lyft</option>
                    <option value="Meals">Meals</option>
                    <option value="Drinks">Drinks</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <div class="field-group">
                  <label for="expensePayer">Paid by</label>
                  <select id="expensePayer">
                    <option value="">Select camper</option>
                  </select>
                </div>

                <div class="field-group">
                  <label for="expenseNotes">Notes (optional)</label>
                  <input id="expenseNotes" type="text" placeholder="Tip, cash bar, tickets, etc." />
                </div>

                <button type="button" class="btn btn-secondary" id="addExpenseBtn">
                  <span class="icon">‚ûï</span> Add expense
                </button>
              </div>

              <!-- Expenses + summary -->
              <div class="expense-layout">
                <div class="expense-list">
                  <h3 class="mini-heading">All expenses</h3>
                  <div id="expenseTable" class="expense-table-empty">
                    No expenses added yet.
                  </div>
                </div>

                <div class="expense-summary">
                  <!-- Running Totals Header + Toggle -->
                  <div class="summary-header">
                    <h3 class="mini-heading">Running totals</h3>
                    <button type="button" id="toggleTotals" class="summary-toggle">
                      <span class="toggle-label">Show</span>
                      <span class="toggle-icon">‚ñæ</span>
                    </button>
                  </div>

                  <div id="totalsContainer" class="collapsible">
                    <div id="expenseTotals" class="expense-summary-body" style="margin-bottom:8px;">
                      Add campers and expenses to see totals.
                    </div>
                  </div>

                  <!-- Per-Person Balances Header + Toggle -->
                  <div class="summary-header" style="margin-top:12px;">
                    <h3 class="mini-heading">Per-person balances</h3>
                    <button type="button" id="toggleBalances" class="summary-toggle">
                      <span class="toggle-label">Show</span>
                      <span class="toggle-icon">‚ñæ</span>
                    </button>
                  </div>

                  <div id="balancesContainer" class="collapsible">
                    <div id="expenseSummary" class="expense-summary-body" style="margin-bottom:8px;">
                      Add campers and expenses to see balances.
                    </div>
                  </div>

                  <!-- Suggested paybacks header + toggle -->
                  <div class="settlements-header">
                    <h3 class="mini-heading" style="margin-top:10px;">Suggested paybacks</h3>
                    <button type="button" id="toggleSettlements" class="settlements-toggle">
                      <span class="toggle-label">Show</span>
                      <span class="toggle-icon">‚ñæ</span>
                    </button>
                  </div>

                  <div id="expenseSettlements" class="expense-summary-body collapsible">
                    Add campers and expenses to see who should pay whom.
                  </div>
                </div>
              </div>
            </section>
          </div>
        </details>
      </main>

      <footer>
        <span>Camp Acey ‚Ä¢ Lake Placid Bachelorette Weekend ‚Ä¢ "What happens at the cabin stays at the cabin."</span>
      </footer>
    </div>
  </div>

  <script>
    const EXPENSES_API_URL = 'https://script.google.com/macros/s/AKfycbyOjL7cEw2gxlozhl-XFP6IpejjW7O91FFqrshU8CQ0cVp31tuQyfeBZh3uHiPqpLJD5A/exec';
    const API_URL = 'https://script.google.com/macros/s/AKfycbxbxwjIL7yxbqMqQ4kJ50AZmrTVUQ-lDX-TSP-Fsk0Fs5i2TxBa0hnS2tzFG_8n80A8Kg/exec';

    const CATEGORY_MAP = {
      snacks: 'Snacks & chips',
      desserts: 'Desserts / sweet treats',
      charcuterie: 'Charcuterie / cheese board',
      breakfast: 'Breakfast & brunch items',
      alcohol: 'Beer/Wine/Liquor',
      na: 'NA Beverages / mixers',
      coffee: 'Coffee & tea station',
      game: 'Game/Activity',
      decor: 'Decor & ambiance',
      otherItem: 'Other Item'
    };

    const CATEGORY_INFO = {
      'Snacks & chips':            { label: 'Snacks & chips' },
      'Desserts / sweet treats':   { label: 'Desserts / sweet treats' },
      'Charcuterie / cheese board':{ label: 'Charcuterie / cheese board' },
      'Breakfast & brunch items':  { label: 'Breakfast & brunch items' },
      'Beer/Wine/Liquor':          { label: 'Beer/Wine/Liquor' },
      'NA Beverages / mixers':     { label: 'NA Beverages / mixers' },
      'Coffee & tea station':      { label: 'Coffee & tea station' },
      'Game/Activity':             { label: 'Game/Activity' },
      'Decor & ambiance':          { label: 'Decor & ambiance' },
      'Other Item':                { label: 'Other Item' }
    };

    const CATEGORY_ORDER = [
      'Snacks & chips',
      'Desserts / sweet treats',
      'Charcuterie / cheese board',
      'Breakfast & brunch items',
      'Beer/Wine/Liquor',
      'NA Beverages / mixers',
      'Coffee & tea station',
      'Game/Activity',
      'Decor & ambiance',
      'Other Item'
    ];

    async function fetchContributions() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        renderContributions(data.items || []);
      } catch (err) {
        console.error('Error loading contributions', err);
      }
    }

async function deleteContribution(timestamp) {
  if (!API_URL) return { ok: false };

  try {
    const body = new URLSearchParams({
      payload: JSON.stringify({
        type: 'deleteContribution',
        timestamp   // use timestamp to identify the row in the Sheet
      })
    });

    const res = await fetch(API_URL, {
      method: 'POST',
      body
    });

    const data = await res.json();
    if (data.status === 'success') {
      return { ok: true };
    } else {
      console.error('Error from contributions API', data);
      return { ok: false, error: data.message };
    }
  } catch (err) {
    console.error('Network error deleting contribution', err);
    return { ok: false, error: 'Network error' };
  }
}

// Try to map free-text items (old data) into a real category
function guessCategoryFromText(text) {
  if (!text) return 'Other Item';
  const t = text.toLowerCase();

  if (t.includes('chip') || t.includes('guac') || t.includes('dip') ||
      t.includes('salsa') || t.includes('hummus') || t.includes('snack')) {
    return 'Snacks & chips';
  }

  if (t.includes('cookie') || t.includes('brownie') || t.includes('cake') ||
      t.includes('cupcake') || t.includes('dessert') || t.includes('sweet') ||
      t.includes('candy')) {
    return 'Desserts / sweet treats';
  }

  if (t.includes('charcuterie') || t.includes('cheese') || t.includes('meat') ||
      t.includes('cracker') || t.includes('salami') || t.includes('prosciutto')) {
    return 'Charcuterie / cheese board';
  }

  if (t.includes('breakfast') || t.includes('brunch') || t.includes('bagel') ||
      t.includes('egg') || t.includes('bacon') || t.includes('pancake') ||
      t.includes('waffle') || t.includes('quiche') || t.includes('muffin') ||
      t.includes('croissant')) {
    return 'Breakfast & brunch items';
  }

  if (t.includes('vodka') || t.includes('tequila') || t.includes('wine') ||
      t.includes('beer') || t.includes('whiskey') || t.includes('bourbon') ||
      t.includes('champagne') || t.includes('prosecco') || t.includes('liquor')) {
    return 'Beer/Wine/Liquor';
  }

  if (t.includes('seltzer') || t.includes('soda') || t.includes('juice') ||
      t.includes('mocktail') || t.includes('mixer') || t.includes('na ')) {
    return 'NA Beverages / mixers';
  }

  if (t.includes('coffee') || t.includes('tea') || t.includes('creamer') ||
      t.includes('syrup') || t.includes('sugar')) {
    return 'Coffee & tea station';
  }

  if (t.includes('game') || t.includes('twister') || t.includes('cards') ||
      t.includes('uno') || t.includes('jenga')) {
    return 'Game/Activity';
  }

  if (t.includes('decor') || t.includes('banner') || t.includes('balloon') ||
      t.includes('garland') || t.includes('lights') || t.includes('fairy') ||
      t.includes('sign') || t.includes('confetti')) {
    return 'Decor & ambiance';
  }

  return 'Other Item';
}

    async function handleFormSubmit(e) {
      e.preventDefault();

      if (!API_URL) return;

      const nameSelect = document.getElementById('name');
      const camperName = (nameSelect && nameSelect.value.trim()) || '';

      if (!camperName) {
        alert('Please select your name before submitting.');
        return;
      }

      // Collect all items the camper filled in
      const items = [];
      document.querySelectorAll('.contrib-item').forEach(block => {
        const category = block.getAttribute('data-category');
        const input = block.querySelector('input[type="text"]');
        if (!category || !input) return;

        const description = input.value.trim();
        if (description) {
          items.push({ category, description });
        }
      });

      if (!items.length) {
        alert('Please enter at least one item you are bringing.');
        return;
      }

      try {
        const body = new URLSearchParams({
          payload: JSON.stringify({
            name: camperName,
            items
          })
        });

        const res = await fetch(API_URL, {
          method: 'POST',
          body
        });

        const data = await res.json();

        if (data.status === 'success') {
          // Clear the text inputs
          document
            .querySelectorAll('.contrib-item input[type="text"]')
            .forEach(inp => (inp.value = ''));

          // Refresh the live lists
          fetchContributions();

          alert('Got it! Your contributions have been saved.');
        } else {
          console.error('Error from contributions API', data);
          alert('There was a problem saving your contributions. Please try again.');
        }
      } catch (err) {
        console.error('Network error saving contributions', err);
        alert('There was a network problem. Please try again.');
      }
    }


      function renderContributions(items) {
      // ---- 1) Update the per-category ‚ÄúAlready bringing‚Äù text ----
      const grouped = {};
      (items || []).forEach(item => {
        const cat = item.category;
        if (!grouped[cat]) grouped[cat] = [];
        grouped[cat].push(item);
      });

      document.querySelectorAll('.contrib-item').forEach(block => {
        const cat = block.getAttribute('data-category');
        const namesDiv = block.querySelector('.contrib-names');
        if (!namesDiv) return;

        const list = grouped[cat] || [];
        if (list.length === 0) {
          namesDiv.textContent = 'No one has claimed this yet.';
          namesDiv.style.fontSize = '0.78rem';
          namesDiv.style.color = '#6b7a86';
        } else {
          const names = list
            .map(i => i.name + (i.description ? ` (${i.description})` : ''))
            .join(', ');
          namesDiv.textContent = 'Already bringing: ' + names;
          namesDiv.style.fontSize = '0.78rem';
          namesDiv.style.color = '#1f3b32';
        }
      });

      // ---- 2) Build the full contribution list (grouped by category) ----
      const tableDiv = document.getElementById('all-contrib-table');
      if (!tableDiv) return;

      if (!items || items.length === 0) {
        tableDiv.innerHTML = "<p>No contributions yet ‚Äî be the first one! üèïÔ∏è</p>";
        return;
      }

      const byCategory = {};
      items.forEach(i => {
        const cat = i.category || 'Other Item';
        if (!byCategory[cat]) byCategory[cat] = [];
        byCategory[cat].push(i);
      });

      // Sort each category's list by name then description
      Object.keys(byCategory).forEach(cat => {
        byCategory[cat].sort((a, b) => {
          const nameCmp = (a.name || '').localeCompare(b.name || '');
          if (nameCmp !== 0) return nameCmp;
          return (a.description || '').localeCompare(b.description || '');
        });
      });

      const catsInData = Object.keys(byCategory);
      const orderedCats = CATEGORY_ORDER.filter(cat => catsInData.includes(cat));
      catsInData.forEach(cat => {
        if (!orderedCats.includes(cat)) orderedCats.push(cat);
      });

      let html = '';

      orderedCats.forEach(cat => {
        const list = byCategory[cat];
        if (!list || list.length === 0) return;

        const label = CATEGORY_INFO[cat]?.label || cat;
        const groupId = 'contrib-' + cat.toLowerCase().replace(/[^a-z0-9]+/g, '-');

        html += `
          <div class="contrib-group">
            <button
              type="button"
              class="full-contrib-header"
              data-target="${groupId}"
            >
              <span class="cat-label">${label}</span>
              <span class="pill">${list.length}</span>
              <span class="chevron">‚ñæ</span>
            </button>

            <div class="contrib-body" id="${groupId}">
              <div class="contrib-body-head">
                <span>Name</span>
                <span>Item</span>
                <span></span>
              </div>

              ${list
                .map(i => `
                  <div class="contrib-row">
                    <div class="contrib-row-name">${i.name || ''}</div>
                    <div class="contrib-row-item">${i.description || ''}</div>
                    <div class="contrib-row-actions">
                      ${
                        i.timestamp
                          ? `<button
                               type="button"
                               class="contrib-remove"
                               data-timestamp="${i.timestamp}"
                             >
                               Remove
                             </button>`
                          : ''
                      }
                    </div>
                  </div>
                `)
                .join('')}
            </div>
          </div>
        `;
      });

      tableDiv.innerHTML = html;
      attachContributionAccordions();
      attachContributionDeleteHandlers();
    }

    function attachContributionAccordions() {
      document.querySelectorAll('.full-contrib-header').forEach(btn => {
        btn.addEventListener('click', () => {
          const group = btn.closest('.contrib-group');
          if (!group) return;
          group.classList.toggle('open');
        });
      });
    }

    function attachContributionDeleteHandlers() {
      const buttons = document.querySelectorAll('.contrib-remove');

      buttons.forEach(btn => {
        btn.addEventListener('click', async () => {
          const ts = btn.dataset.timestamp;
          if (!ts) return;

          const ok = confirm('Remove this contribution from the list?');
          if (!ok) return;

          const result = await deleteContribution(ts);
          if (!result.ok) {
            alert('There was a problem removing this contribution. Please try again.');
            return;
          }

          // Reload from Sheet so the UI stays in sync
          fetchContributions();
        });
      });
    }



    function attachAccordions() {
      document.querySelectorAll('.accordion-header').forEach(btn => {
        btn.onclick = () => {
          const group = btn.closest('.contrib-accordion');
          if (!group) return;
          const open = group.classList.contains('open');
          if (open) {
            group.classList.remove('open');
          } else {
            group.classList.add('open');
          }
        };
      });
    }

function attachContributionDeleteHandlers() {
  const buttons = document.querySelectorAll('.contrib-remove');

  buttons.forEach(btn => {
    btn.addEventListener('click', async () => {
      const ts = btn.dataset.timestamp;
      if (!ts) return;

      const ok = confirm('Remove this contribution from the list?');
      if (!ok) return;

      const result = await deleteContribution(ts);
      if (!result.ok) {
        alert('There was a problem removing this contribution. Please try again.');
        return;
      }

      // Reload contributions from the server so the list stays in sync
      fetchContributions();
    });
  });
}

    /* Countdown */
    const CAMP_START = new Date('2026-01-30T16:00:00');

    function updateCountdown() {
      const container = document.getElementById('camp-countdown');
      if (!container) return;

      const now = new Date();
      let diff = CAMP_START - now;

      const noteEl = document.getElementById('cd-note');

      if (diff <= 0) {
        if (noteEl) {
          noteEl.textContent = 'Camp Acey is happening now or has already wrapped! üíç';
        }
        ['cd-days','cd-hours','cd-mins','cd-secs'].forEach(id => {
          const el = document.getElementById(id);
          if (el) el.textContent = '0';
        });
        return;
      }

      const secondsTotal = Math.floor(diff / 1000);
      const days = Math.floor(secondsTotal / (60 * 60 * 24));
      const hours = Math.floor((secondsTotal % (60 * 60 * 24)) / (60 * 60));
      const mins = Math.floor((secondsTotal % (60 * 60)) / 60);
      const secs = secondsTotal % 60;

      const dEl = document.getElementById('cd-days');
      const hEl = document.getElementById('cd-hours');
      const mEl = document.getElementById('cd-mins');
      const sEl = document.getElementById('cd-secs');

      if (dEl) dEl.textContent = String(days);
      if (hEl) hEl.textContent = String(hours).padStart(2, '0');
      if (mEl) mEl.textContent = String(mins).padStart(2, '0');
      if (sEl) sEl.textContent = String(secs).padStart(2, '0');

      if (noteEl) {
        if (days <= 3) {
          noteEl.textContent = 'Pack your bags! Camp Acey is almost here. üß£üî•';
        } else {
          noteEl.textContent = 'Time to plan outfits, snacks, and shenanigans. ‚ú®';
        }
      }
    }

    function startCountdown() {
      updateCountdown();
      setInterval(updateCountdown, 1000);
    }

    /* Expenses logic */

    const CAMPERS = [
      'Jenny',
      'Andrea',
      'Steph',
      'Abby',
      'Lindsay',
      'Jamie',
      'Nicole',
      'Chelsea',
      'Danni',
      'Missy',
      'Alexa'
    ];

    function initCamperNameDropdown() {
      const select = document.getElementById('name');
      if (!select) return;
      select.innerHTML = '<option value="">Select your name</option>' +
        CAMPERS.map(name => `<option value="${name}">${name}</option>`).join('');
    }

    let expenses = [];

    function getCampers() {
      return CAMPERS;
    }

    function refreshPayerAndParticipants() {
      const campers = getCampers();

      const select = document.getElementById('expensePayer');
      if (select) {
        const current = select.value;
        select.innerHTML = '<option value="">Select camper</option>';
        campers.forEach(name => {
          const opt = document.createElement('option');
          opt.value = name;
          opt.textContent = name;
          select.appendChild(opt);
        });
        if (campers.includes(current)) {
          select.value = current;
        }
      }

      const container = document.getElementById('expenseParticipants');
      if (container) {
        if (campers.length === 0) {
          container.innerHTML = '<small class="field-hint">Add campers above to choose participants.</small>';
          return;
        }

        container.innerHTML = campers.map(name => `
          <label class="participants-label">
            <input type="checkbox" value="${name}">
            <span class="participants-toggle">
              <span class="toggle-dot"></span>
              <span class="toggle-name">${name}</span>
            </span>
          </label>
        `).join('');
      }
    }

    function renderExpensesAndBalances() {
      const tableDiv       = document.getElementById('expenseTable');
      const summaryDiv     = document.getElementById('expenseSummary');
      const totalsDiv      = document.getElementById('expenseTotals');
      const settlementsDiv = document.getElementById('expenseSettlements');
      const campers        = getCampers();

      if (!tableDiv || !summaryDiv) return;

      if (!expenses.length) {
        tableDiv.textContent = 'No expenses added yet.';
      } else {
        const rowsHtml = expenses.map((exp, idx) => `
          <div class="expense-row">
            <div>
              <div class="expense-row-main">${exp.desc}</div>
              <div class="expense-row-note">
                ${exp.category ? exp.category + ' ‚Ä¢ ' : ''}Participants: ${exp.participants.join(', ')}
                ${exp.note ? ' ‚Ä¢ ' + exp.note : ''}
              </div>
            </div>
            <div class="expense-amount">$${exp.amount.toFixed(2)}</div>
            <div class="expense-meta">
              Paid by ${exp.payer}
              <button
                type="button"
                class="expense-remove"
                data-expense-index="${idx}"
              >
                Remove
              </button>
            </div>
          </div>
        `).join('');

        tableDiv.innerHTML = rowsHtml;

        document.querySelectorAll('.expense-remove').forEach(btn => {
          btn.addEventListener('click', async () => {
            const idx = Number(btn.dataset.expenseIndex);
            const exp = expenses[idx];
            if (!exp) return;

            const ok = confirm('Remove this expense from the trip?');
            if (!ok) return;

            const result = await deleteExpenseFromSheet(exp);
            if (!result.ok) {
              alert('There was a problem removing this expense. Please try again.');
              return;
            }

            expenses.splice(idx, 1);
            renderExpensesAndBalances();
          });
        });
      }

      if (!campers.length || !expenses.length) {
        if (summaryDiv) {
          summaryDiv.textContent = 'Add campers and expenses to see balances.';
        }
        if (totalsDiv) {
          totalsDiv.textContent = 'Add campers and expenses to see totals.';
        }
        if (settlementsDiv) {
          settlementsDiv.textContent = 'Add campers and expenses to see who should pay whom.';
        }
        return;
      }

      const grandTotal = expenses.reduce((sum, exp) => sum + (exp.amount || 0), 0);
      const paidTotals = {};
      campers.forEach(name => (paidTotals[name] = 0));
      expenses.forEach(exp => {
        if (exp.payer && paidTotals.hasOwnProperty(exp.payer)) {
          paidTotals[exp.payer] += exp.amount || 0;
        }
      });

      const avgPerCamper = grandTotal / campers.length;

      if (totalsDiv) {
        const totalsHtml = `
          <div style="margin-bottom:6px;">
            <strong>Total spent so far:</strong> $${grandTotal.toFixed(2)}
          </div>
          <div style="margin-bottom:10px; font-size:0.8rem; color:#6b7a86;">
            If everything were split evenly between all campers, that would be
            about <strong>$${avgPerCamper.toFixed(2)}</strong> per person.
          </div>
          <div style="margin-bottom:4px; font-size:0.8rem; color:#6b7a86;">
            Paid so far:
          </div>
          ${campers.map(name => {
            const paid = paidTotals[name] || 0;
            return `
              <div class="balance-row">
                <span class="balance-name">${name}</span>
                <span class="balance-amount">$${paid.toFixed(2)} paid</span>
              </div>
            `;
          }).join('')}
        `;
        totalsDiv.innerHTML = totalsHtml;
      }

      const balances = {};
      campers.forEach(name => (balances[name] = 0));

      expenses.forEach(exp => {
        if (!exp || !exp.payer || !(exp.amount > 0)) return;

        let participants =
          Array.isArray(exp.participants) && exp.participants.length
            ? exp.participants.slice()
            : campers.slice();

        if (!participants.includes(exp.payer)) {
          participants.push(exp.payer);
        }

        const share = exp.amount / participants.length;

        participants.forEach(name => {
          if (balances[name] !== undefined) {
            balances[name] -= share;
          }
        });

        if (balances[exp.payer] !== undefined) {
          balances[exp.payer] += exp.amount;
        }
      });

      const summaryRows = campers.map(name => {
        const raw = balances[name] || 0;
        const val = Math.round(raw * 100) / 100;
        let actionText;
        let amountText = '';

        if (val > 0.01) {
          actionText = 'should receive';
          amountText = `$${val.toFixed(2)}`;
        } else if (val < -0.01) {
          actionText = 'should pay';
          amountText = `$${Math.abs(val).toFixed(2)}`;
        } else {
          actionText = 'is all settled up';
        }

        const amountClass =
          'settle-amount ' + (val >= 0 ? 'balance-positive' : 'balance-negative');

        return `
          <div class="balance-row settle-line">
            <span class="settle-name">${name}</span>
            <span class="settle-action">${actionText}</span>
            ${
              amountText
                ? `<span class="${amountClass}">${amountText}</span>`
                : ''
            }
          </div>
        `;
      }).join('');

      summaryDiv.innerHTML = summaryRows;

      if (settlementsDiv) {
        const pairOwes = {};
        const safeCampers = campers.slice();

        expenses.forEach(exp => {
          if (!exp || !exp.payer || !(exp.amount > 0)) return;

          let participants =
            Array.isArray(exp.participants) && exp.participants.length
              ? exp.participants.slice()
              : safeCampers.slice();

          if (!participants.includes(exp.payer)) {
            participants.push(exp.payer);
          }

          const share = exp.amount / participants.length;

          participants.forEach(fromName => {
            if (fromName === exp.payer) return;

            if (!pairOwes[fromName]) {
              pairOwes[fromName] = {};
            }
            if (!pairOwes[fromName][exp.payer]) {
              pairOwes[fromName][exp.payer] = 0;
            }

            pairOwes[fromName][exp.payer] += share;
          });
        });

        const settlements = [];

        safeCampers.forEach(fromName => {
          safeCampers.forEach(toName => {
            if (fromName === toName) return;

            const pay =
              (pairOwes[fromName] && pairOwes[fromName][toName]) || 0;
            const flip =
              (pairOwes[toName] && pairOwes[toName][fromName]) || 0;

            const net = Math.round((pay - flip) * 100) / 100;

            if (net > 0.01) {
              settlements.push({
                from: fromName,
                to: toName,
                amount: net
              });
            }
          });
        });

        if (!settlements.length) {
          settlementsDiv.textContent = 'Everyone is all settled up. üéâ';
        } else {
          const settlementsHtml = `
            <div style="margin-bottom:6px; font-size:0.8rem; color:#6b7a86;">
              These are direct paybacks after canceling out overlapping expenses:
            </div>
            ${settlements.map(s => `
              <div class="balance-row settle-line">
                <span class="settle-name">${s.from}</span>
                <span class="settle-action">pays</span>
                <span class="settle-name">${s.to}</span>
                <span class="settle-amount balance-negative">$${s.amount.toFixed(2)}</span>
              </div>
            `).join('')}
          `;
          settlementsDiv.innerHTML = settlementsHtml;
        }
      }
    }

    async function loadExpensesFromSheet() {
  if (!EXPENSES_API_URL) return;
  try {
    const res = await fetch(EXPENSES_API_URL);
    const data = await res.json();

    expenses = (data.items || [])
      .map(item => ({
        desc: item.desc,
        amount: Number(item.amount) || 0,
        category: item.category || '',
        payer: item.payer || '',
        participants: item.participants || [],
        note: item.note || '',
        // assume the API gives a timestamp string; if not, this will just be null
        timestamp: item.timestamp ? new Date(item.timestamp) : null
      }))
      .sort((a, b) => {
        // newest (largest timestamp) first
        if (a.timestamp && b.timestamp) {
          return b.timestamp - a.timestamp;
        }
        return 0;
      });

    renderExpensesAndBalances();
  } catch (err) {
    console.error('Error loading expenses', err);
  }
}


    async function addExpenseToSheet(expense) {
      if (!EXPENSES_API_URL) return { ok: false };

      try {
        const body = new URLSearchParams({
          payload: JSON.stringify({
            type: 'addExpense',
            expense
          })
        });

        const res = await fetch(EXPENSES_API_URL, {
          method: 'POST',
          body
        });

        const data = await res.json();

        if (data.status === 'success') {
          return { ok: true };
        } else {
          console.error('Error from API', data);
          return { ok: false, error: data.message };
        }
      } catch (err) {
        console.error('Network error', err);
        return { ok: false, error: 'Network error' };
      }
    }

    async function deleteExpenseFromSheet(expense) {
      if (!EXPENSES_API_URL) return { ok: false };
      try {
        const body = new URLSearchParams({
          payload: JSON.stringify({
            type: 'deleteExpense',
            expense
          })
        });

        const res = await fetch(EXPENSES_API_URL, {
          method: 'POST',
          body
        });

        const data = await res.json();
        if (data.status === 'success') {
          return { ok: true };
        } else {
          console.error('Error from API', data);
          return { ok: false, error: data.message };
        }
      } catch (err) {
        console.error('Network error', err);
        return { ok: false, error: 'Network error' };
      }
    }

    function initBudgetTracker() {
      const addBtn = document.getElementById('addExpenseBtn');
      if (!addBtn) return;

      refreshPayerAndParticipants();
      loadExpensesFromSheet();

      addBtn.addEventListener('click', async () => {
        const descInput = document.getElementById('expenseDesc');
        const amountInput = document.getElementById('expenseAmount');
        const categorySelect = document.getElementById('expenseCategory');
        const payerSelect = document.getElementById('expensePayer');
        const notesInput = document.getElementById('expenseNotes');
        const participantsContainer = document.getElementById('expenseParticipants');

        const desc = descInput.value.trim();
        const amount = parseFloat(amountInput.value);
        const category = categorySelect.value;
        const payer = payerSelect.value;
        const note = notesInput.value.trim();
        const campers = getCampers();

        if (!desc) {
          alert('Please add a short description for the expense.');
          return;
        }
        if (!(amount > 0)) {
          alert('Please enter an amount greater than 0.');
          return;
        }
        if (!category) {
          alert('Please choose a category.');
          return;
        }
        if (!payer) {
          alert('Please select who paid for this.');
          return;
        }
        if (!campers.includes(payer)) {
          alert('The payer must be in the camper list.');
          return;
        }
        if (!campers.length) {
          alert('Please define at least one camper.');
          return;
        }

        let participants = [];
        if (participantsContainer) {
          participants = Array.from(
            participantsContainer.querySelectorAll('input[type="checkbox"]:checked')
          ).map(cb => cb.value);
        }
        if (!participants.length) {
          participants = [...campers];
        }

        const expense = { desc, amount, category, payer, note, participants };

        const result = await addExpenseToSheet(expense);
        if (!result.ok) {
          alert('There was a problem saving this expense. Please try again.');
          return;
        }

        // put newest expense at the top of the list
expenses.unshift(expense);


        descInput.value = '';
        amountInput.value = '';
        notesInput.value = '';
        categorySelect.value = '';

        renderExpensesAndBalances();
      });
    }

    function initSelectAllParticipants() {
      const toggle = document.getElementById("toggleAllParticipants");
      if (!toggle) return;

      toggle.addEventListener("click", () => {
        const checkboxes = document.querySelectorAll('#expenseParticipants input[type="checkbox"]');
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);

        if (allChecked) {
          checkboxes.forEach(cb => cb.checked = false);
          toggle.textContent = "Select all";
        } else {
          checkboxes.forEach(cb => cb.checked = true);
          toggle.textContent = "Unselect all";
        }
      });
    }

    function setupToggle(buttonId, containerId) {
      const btn = document.getElementById(buttonId);
      const box = document.getElementById(containerId);
      if (!btn || !box) return;

      box.classList.remove('open');
      const labelSpan = btn.querySelector('.toggle-label');
      const iconSpan = btn.querySelector('.toggle-icon');

      if (labelSpan) labelSpan.textContent = 'Show';
      if (iconSpan) iconSpan.style.transform = 'rotate(0deg)';

      btn.addEventListener('click', () => {
        const isOpen = box.classList.contains('open');

        if (isOpen) {
          box.classList.remove('open');
          if (labelSpan) labelSpan.textContent = 'Show';
          if (iconSpan) iconSpan.style.transform = 'rotate(0deg)';
        } else {
          box.classList.add('open');
          if (labelSpan) labelSpan.textContent = 'Hide';
          if (iconSpan) iconSpan.style.transform = 'rotate(180deg)';
        }
      });
    }

    document.addEventListener('DOMContentLoaded', () => {
      initCamperNameDropdown();
      fetchContributions();
      initBudgetTracker();
      startCountdown();
      initSelectAllParticipants();
      setupToggle('toggleTotals', 'totalsContainer');
      setupToggle('toggleBalances', 'balancesContainer');
      setupToggle('toggleSettlements', 'expenseSettlements');
    });
  </script>
</body>
</html>
